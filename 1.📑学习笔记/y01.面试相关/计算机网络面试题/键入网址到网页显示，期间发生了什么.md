![image.png](https://raw.githubusercontent.com/mowang111/image-hosting/master/typora_images/20230221230905.png)


1. 浏览器做的第一步工作就是解析URL

2. 经过URL进行解析之后，浏览器确定了Web服务器和文件名，接下来就是根据这些信息来生成HTTP请求消息

3. 在发送消息之前，需要查询服务器域名对应的IP地址——DNS协议(首先是查询缓存有没有对应域名，然后看hosts文件，最后才会去问【本地DNS服务器】)

4. 通过DNS获取到IP后，将HTTP的传输工作交给操作系统中的协议栈。 
![image.png](https://raw.githubusercontent.com/mowang111/image-hosting/master/typora_images/20230221232124.png)
应用程序（浏览器）通过调用Socket库，来委托协议栈工作。协议栈的上半部分有两块，分别是负责收发数据的TCP和UDP协议，这两个传输协议会接受应用层的委托执行收发数据的操作

协议栈的下面一半是用IP协议控制网络包收发操作，在互联网上传数据时，数据会被切分成一块块的网络包，而将网络包发送给对方的操作就是由IP负责。

此外IP中还包括ICMP协议和ARP协议
+ ICMP用于告知网络包传送过程中产生的错误以及各种控制信息。
+ ARP用于根据IP地址查询相应的以太网MAC地址

IP下面的网卡驱动程序负责控制网卡硬件
+ 当存在多个网卡时，在填写源地址IP时，就需要判断到底应该填写哪个地址。这个判断相当于在多块网卡中判断应该使用哪个网卡发送包
	+ 这时候需要根据【路由表规则】，来判断哪个网卡作为源地址IP。
		+ IP地址分别和路由表中对应的子网掩码进行与运算，发现和目的IP匹配，则确定发送的网卡

最下面的网卡则负责完成实际的收发操作，也就是对网线中的信号执行发送和接收操作
+ 在生成了IP头部之后，接下来网络包还需要在IP头部前面加上MAC头部
+ 一般在TCP/IP通信里，MAC包头协议类型只使用：
	+ 0800：IP协议
	+ 0806：ARP协议
+ MAC头部里需要发送方MAC地址和接收方的目标MAC地址，用于两点之间的传输
+ 那么如何知道接收方的MAC地址呢？
	+ 首先在路由表中已经查到下一跳的目标IP
	+ 然后使用ARP协议找到对应MAC地址


网络包只是存放在内存中的一串二进制数字信息，没办法直接发送给对方，需要使用网卡将数字信号转换为电信号，要控制网卡还需要靠网卡驱动程序。
+ 网卡驱动获取网络包之后，会将其复制到网卡内的缓存区中，接着会在其开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列


网络包到达交换机，交换机根据MAC地址表查找MAC地址，然后将信号发送到相应的端口。
+ 交换机的MAC地址表主要包含两个信息：
	+ 一个是设备的MAC地址
	+ 一个是该设备连接在交换机的哪个端口上
+ 如果地址表中找不到指定的MAC地址，可能是因为具有该地址的设备还没有向交换机发送过包，或者这个设备一段时间没有工作导致地址被从地址表中删除了。这种情况下，交换机将包转发到除源端口之外的所有端口。

>计算机的网卡本身具有MAC地址，并通过核对收到的包的接收方MAC地址判断是不是发给自己的，如果不是发给自己的则丢弃；相对地，交换机的端口不核对接收方的MAC地址，而是直接接收所有的包并存放到缓冲区。因此，和网卡不同，交换机的端口不具有MAC地址。


网络包经过交换机之后，到达了路由器，并再次被转发到了下一个路由器或目标设备
+ 路由器是基于IP设计的，是三层网络设备，路由器的各个端口都具有MAC地址和IP地址
+ 而交换机是基于以太网设计的，是二层网络设备，交换机的端口不具有MAC地址

当转发包时，首先路由器端口会接收发给自己的以太网包，然后路由表查询转发目标，再由相应的端口作为发送方将以太网包发送出去
+ 路由器会检测MAC头部的接收方MAC地址，判断是否是发给自己的 
+ 完成包接收操作之后，路由器就会去掉包开头的MAC头部，MAC头部的作用就是将包送达路由器
+ 接下来，路由器会根据MAC头部后方的IP头部中的内容进行包的转发
	+ 首先查询路由表判断转发目标
	+ 进入包的发送操作
		+ 根据路由表的【网关列】判断对方的地址
			+ 如果网关是一个IP，就需要继续路由器转发
			+ 如果网关为空，则IP头部中的接收方IP地址就是要转发的目标地址
		+ 再次使用ARP协议根据IP地址查询MAC地址

数据包到达服务器后，服务器就会以此检查MAC头部，IP头部，TCP头部，到达HTTP进程，然后返回HTTP响应报文。





