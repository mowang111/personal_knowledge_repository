# DNS
整体流程：浏览器搜索自身的DNS缓存、搜索操作系统的DNS缓存、读取本地的Host文件和向本地DNS服务器进行查询等，

1. 递归查询：当A向B查询某个域名的IP地址时，如果B不知道被查询的域名的IP地址，那么B会替A向更上层的服务器发起查询，将查询结果返回给A
2. 迭代查询：当A向B查询某个域名的IP地址时，如果B不知道被查询的域名的IP地址，B会告诉A下一步应该向哪个服务器查询，由A自己去查。
一般来说，主机向本地域名服务器的查询是递归查询，而本地域名服务器向根域名服务器的查询是迭代查询

# IP
IP协议（头部20个字节）使用逐跳的方式确定通信路径，为上层协议提供无状态、无连接、不可靠的服务
+ 无状态 是指IP通信双方不同步传输数据的状态信息，因此所有IP数据报的发送、传输和接收都是相互独立、没有上下文关系的，这种服务最大的缺点是无法处理乱序和重复的IP数据报
+ 无连接 是指IP通信双方都不长久地维持对方的任何信息，上层协议每次发送数据是，都必须明确指定对方的IP地址
+ 不可靠 是指IP协议不能保证IP数据报准确地达到接收端，即使检测到IP数据报发送失败，则通知上层协议发送失败，而不会试图重传

IP转发处理步骤：
1. 检查数据报头部的TTL值，如果等于0则丢弃该数据报
2. 查看数据报头部的严格源路由选择选项。如果该项被设置，则检测数据报的目标IP地址是否是本机的某个IP地址。如果不是，则发送一个ICMP源站选路失败报文给发送端。如果有必要，则给源端发送一个ICMP重定向报文，以告诉它一个更合理的下一跳路由。
3. 将TTL值减一
4. 处理IP头部选项。如果有必要，执行IP分片操作

# WebSocket
握手过程
1. 浏览器、服务器建立TCP连接，三次握手
2. TCP连接成功后，浏览器通过HTTP协议向服务器传送WebSocket支持的版本号信息
3. 服务器收到客户端的握手请求后，同样采用HTTP协议回馈数据
4. 当收到连接成功的消息后，通过TCP通道进行传输通信。

### Websocket与HTTP的关系
相同点：
1. 都是基于TCP的、可靠的传输协议
2. 都是应用层协议
不同点：
1. WebSocket是双向通信协议，模拟Socket协议，可以双向发送或接收信息。HTTP是单向的
2. WebSocket是需要握手进行建立连接的
联系：
WebSocket在建立握手时，数据通过HTTP传输的。但是建立之后，在真正传输的时候是不需要HTTP协议的

WebSocket与Socket关系
1. Socket其实不是一个协议，而是为了方便使用TCP或UDP而抽象出来的一层，是位于应用层和传输层之间的一组接口。当两台主机通信时，必须通过Socket连接，而Socket则利用TCP/IP协议建立TCP连接。
2. WebSocket则是典型的应用层西医

# DHCP
DHCP（动态主机配置协议）是一个局域网的网络协议。指的是由服务器控制一段IP地址范围，客户机登陆服务器时就可以自动获取服务器分配的IP地址和子网掩码。DHCP客户端进程监听的是68端口，DHCP服务端进程监听的是67端口

4个步骤：
+ 客户端首先发起DHCP发现报文（DHCP DISCOVER）的IP数据报，由于客户端没有IP地址，也不知道DHCP服务器的地址，所以使用的是UDP广播通信，其使用的广播目的地址是255.255.255.255（端口67）并且使用0.0.0.0（端口68）作为源IP地址。DHCP客户端将该IP数据报传递给链路层，链路层然后将帧广播到所有的网络中的设备
+ DHCP服务器收到DHCP发现报文时，用DHCP提供报文（DHCP OFFER）向客户端做出相应。该报文仍然使用IP广播地址255.255.255.255，该报文信息携带服务器提供可租约的IP地址、子网掩码、默认网关、DNS服务器以及IP地址租用期。
+ 客户端收到一个或多个服务器的DHCP提供报文后，从中选择一个服务器，并向选中的服务器发送DHCP请求报文进行响应，回显配置的参数
+ 最后，服务端用DHCP ACK报文对DHCP请求报文进行响应，应答所要求的参数
一旦客户端收到DHCP ACK后，交互便完成了，并且客户端能够在租用期内使用DHCP服务器分配的IP地址。

### 如果租约的DHCP IP地址快到期后，客户端会向服务器发送DHCP请求报文
+ 服务器如果同意继续租用，则用DHCP ACK报文进行应答，客户端就会延长租期。
+ 服务器如何不同意继续租用，就用DHCP NACK，客户端就要停止使用租约的IP地址
可以发现，DHCP交互中，全程都是使用UDP广播通信

如果DHCP服务器和客户端不是在同一个局域网内，路由器又不会转发广播包，为了解决这一问题，就出现了DHCP中继代理。有了DHCP中继代理以后，对不同网段的IP地址分配也可以由一个DHCP服务器同一管理。
+ DHCP客户端会像DHCP中继代理发送DHCP请求包，而DHCP中继代理在收到这个广播包以后，再以单播的形式发给DHCP服务器
+ 服务器端收到该包以后再向DHCP中继代理返回应答，并由DHCP中继代理将此包广播给DHCP客户端。
因此，DHCP服务器即使不在同一个链路上也可以实现统一分配和管理IP地址

# NET
由于绝大多数的网络应用都是使用传输层协议TCP或UDP来传输数据的。因此，可以把IP地址+端口号一起进行转换。这样，就用一个全球IP地址就可以了，这种转换技术就叫网络地址与端口转换NAPT。这种转换表在NAT路由器上自动生成。例如，在TCP的情况下，建立TCP连接首次握手时的SYN包一经发出，就会生成这个表。而后又随着收到关闭连接时发出的FIN包的确认应答从表被删除。

由于NAT/NAPT都依赖于自己的转换表，因此会有以下问题：
+ 外部无法主动与NAT内部服务器建立连接，因为NAPT转换表没有转换记录
+ 转换表的生成与转换操作都会产生性能开销
+ 通信过程中，如果NAT路由器重启了，所有的TCP连接都将被重置
解决方法：
+ 第一种改用IPV6：IPV6可用范围非常大，以至于每台设备都可以配置一个公有IP地址，就不用地址转换了
+ 第二种是NAT穿透技术：客户端主动从NAT设备获取公有IP地址，然后自己建立端口映射条目，并用这个条目对外通信，就不需要NAT设备来转换了

# IGMP
IGMP是因特网组管理协议，工作在主机（组播成员）和最后一跳路由之间。IGMP报文向路由器申请加入和退出组播组，默认情况下路由器是不会转发组播包到连接中的主机，除非主机通过IGMP加入到组播组，主机申请加入到组播组时，路由器就会记录IGMP路由器表，路由器后续就会转发组播包到对应主机了。
IGMP报文采用IP封装，IP头部的协议号为2，而且TTL字段值通常为1，因为IGMP是工作在主机与连接的路由器之间

常规查询与响应工作机制
+ 路由器会周期性发送目的地址为224.0.0.1（表示同一网段内所有主机和路由器）IGMP常规查询报文。
+ 主机收到这个查询，随后会启动【报告延迟计时器】，计时器的时间是随机的，通常是0~10秒，计时器超时后主机就会发送IGMP成员关系报告报文（源IP地址为自己主机的IP地址，目的IP地址为组播地址）。如果在定时器超时之前，收到同一个组内的其他主机发送的成员关系报告报文，则自己不再发哦那个，这样可用减少网络中多余的IGMP报文数量
+ 路由器收到主机的成员关系报文后，就会在IGMP路由表中加入该组播组，后续网络中一旦该组播地址的数据到达路由器，它会把数据包转发出去。

离开组播组工作机制
+ 主机1要离开组224.1.1.1,发送IGMPv2离组报文，报文的目的地址是224.0.0.2（表示发向网段内的所有路由器）
+ 路由器收到该报文后，以1秒为间隔连续发送IGMP特定组查询报文（共计发送2个）,以便确认该网络是否还有224.1.1.1组的其他成员
+ 主机 3 仍然是组 224.1.1.1 的成员，因此它⽴即响应这个特定组查询。路由器知道该⽹络中仍然存 在该组播组的成员，于是继续向该⽹络转发 224.1.1.1 的组播数据包。否则不会再向这个⽹段转发该 组播地址的数据包。

