## 全局流程
![[x86的全局启动流程示意图.png]]
## 从BIOS到GRUB
[[从BIOS到GRUB]]
![[从BIOS到GRUB.png]]
## GRUB如何启动
![[GRUB如何启动.png]]
## vmlinuz文件结构
![[bzImage文件结构示意图.png]]
其中 setup.bin由objcopy命令根据setup.elf生成的，而setup.elf由/arch/x86/boot/目录下的一系列程序源代码文件编译连接生成，其中head.S文件和main.S文件格外重要。

vmlinux.bin文件依赖于linux/arch/x86/boot/compressed/目录下的vmlinux目标

linux/arch/x86/boot/compressed 目录下的 vmlinux 是由该目录下的 head_32.o 或者 head_64.o、cpuflags.o、error.o、kernel.o、misc.o、string.o 、cmdline.o 、early_serial_console.o 等文件以及 piggy.o 链接而成的

> 其中，vmlinux.lds 是链接脚本文件。在没做任何编译动作前，前面依赖列表中任何一个目标文件的源文件（除了 piggy.o 源码），我们几乎都可以在 Linux 内核源码里找到。
> piggy.o 是由 piggy.S 汇编代码生成而来，而 piggy.S 是编译 Linux 内核时由 mkpiggy 工作（HOST OS 下的应用程序）动态创建的，

piggy.S 的第一个依赖文件 vmlinux.bin.$(suffix-y) 中的 suffix-y，它表示内核压缩方式对应的后缀。

arch/x86/boot/compressed 目录下的 vmlinux.bin，它是由 objcopy 工具通过 vmlinux 目标生成。而 vmlinux 文件的格式依然是 ELF 格式的，如果不需要使用 ELF 格式的内核，这里添加“-O binary”选项就可以了。