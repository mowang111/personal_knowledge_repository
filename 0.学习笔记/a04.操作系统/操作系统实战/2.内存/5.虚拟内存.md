## x86 CPU虚拟地址空间划分
![[x86虚拟地址划分.png]]

## Cosmos划分虚拟地址空间
![[内核空间与应用空间.png]]
## 虚拟地址数据结构
```plantuml
struct kmvarsdsc_t {
    spinlock_t kva_lock
    u32_t kva_maptype
    list_h_t kva_list
    u64_t kva_flgs
    u64_t kva_limits
    void* kva_mcstruct
    adr_t kva_start
    adr_t kva_end
    kvmemcbox_t* kva_kvmbox
    void* kva_kvmcobj
}
struct virmemadrs_t {
    spinlock_t vs_lock;            ' 保护自身的自旋锁
    u32_t  vs_resalin;
    list_h_t vs_list;              ' 链表，链接虚拟地址区间
    uint_t vs_flgs;                ' 标志
    uint_t vs_kmvdscnr;            ' 多少个虚拟地址区间
    mmadrsdsc_t* vs_mm;            ' 指向它的上层的数据结构
    kmvarsdsc_t* vs_startkmvdsc;   ' 开始的虚拟地址区间
    kmvarsdsc_t* vs_endkmvdsc;     ' 结束的虚拟地址区间
    kmvarsdsc_t* vs_currkmvdsc;    ' 当前的虚拟地址区间
    adr_t vs_isalcstart;           ' 能分配的开始虚拟地址
    adr_t vs_isalcend;             ' 能分配的结束虚拟地址
    void* vs_privte;               ' 私有数据指针
    void* vs_ext;                  ' 扩展数据指针
}
```
